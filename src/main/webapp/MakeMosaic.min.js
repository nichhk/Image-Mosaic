function displayMosaic(e){$(".site-wrapper-inner").hide();$("#mosaicContainer").show();var t=Math.max(document.documentElement.clientWidth,window.innerWidth||0)*.85;var n=Math.max(document.documentElement.clientHeight,window.innerHeight||0);var r=Math.min(t/e.width,n/e.height);console.log("scale is"+r);$("<img>").attr({id:"mosaic",src:e.url,usemap:"#actualmap",width:(e.width*r).toString(),height:(e.height*r).toString()}).prependTo("#picDiv");for(var i=0;i<e.attributionTable.length;i++){var s=e.attributionTable[i];var o=$("<area>");var u=Math.round(parseInt(s.x1)*r);var a=Math.round(parseInt(s.x2)*r);var f=Math.round(parseInt(s.y1)*r);var l=Math.round(parseInt(s.y2)*r);o.attr({id:s.url+","+s.author+","+s.title+","+s.id+","+s.trueUrl+","+s.license,shape:"rect",coords:u.toString()+","+f.toString()+","+a.toString()+","+l.toString(),href:"#"}).appendTo("#mapId")}var c=$("<a>",{text:"Download Mosaic",download:"Collage.png",href:"http://storage.googleapis.com/image-mosaic.appspot.com/"+time+"_mosaic.png"}).addClass("btn btn-info text-center");$(".info").append(c);var h="<i class='glyphicon glyphicon-remove'></i>";if(smartSizing){h="<i class='glyphicon glyphicon-ok'></i>"}readURL(userPic);$("#yourInputs").append($("<tr>").append($("<p>").html("<h5>"+h+" Smart-sizing</h5>"))).append($("<tr>").append($("<p>").html("<h5>Depth: "+depth+"</h5>")));if(smartSizing){$("#yourInputs").append($("<tr>").append($("<p>").html("<h5>Threshold: "+thresh+"</h5>")))}}function checkIsDone(){$.ajax({url:"/get_mosaic",type:"GET",data:"time="+time,processData:false,contentType:false,success:function(e){if(typeof e==="string"){}else{clearInterval(myInterval);displayMosaic(e);$("body").removeClass("loading")}}})}function startCheck(){$("body").addClass("loading");myInterval=setInterval("checkIsDone()",iFrequency)}function readURL(e){if(e.files&&e.files[0]){var t=new FileReader;t.onload=function(e){$("#yourImg").attr("src",e.target.result).addClass("img-responsive")};t.readAsDataURL(e.files[0])}}function makeLicenseLink(e){var t=0;t=Number(e);var n="";var r="";if(t==1){n="CC BY-NC-SA 2.0";r="http://creativecommons.org/licenses/by-nc-sa/2.0/"}else if(t==2){n="CC BY-NC 2.0";r="http://creativecommons.org/licenses/by-nc/2.0/"}else if(t==4){n="CC BY 2.0";r="http://creativecommons.org/licenses/by/2.0/"}else if(t==5){n="CC BY-SA 2.0";r="http://creativecommons.org/licenses/by-sa/2.0/"}else if(t==7){n="No known copyright restrictions";r="http://flickr.com/commons/usage/"}$("#blockInfo").append($("<h5>").html("License<br>").append($("<a>").attr({href:r,target:"_blank"}).html(n)))}function hide(e,t){if(e.is(":hidden")){return}e.slideUp("fast");$(t.find("i")[0]).removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down")}function show(e,t){if(e.is(":hidden")){e.slideDown("fast");$(t.find("i")[0]).removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up");return}}$(function(){$("#showThresh").html($("#threshIn").val());$("#threshIn").change(function(){$("#showThresh").html($("#threshIn").val())})});$(function(){$("#showDepth").html($("#depthIn").val());$("#depthIn").change(function(){$("#showDepth").html($("#depthIn").val())})});$(function(){$("input[name=smartSizing]").change(function(){var e=$('input[name="smartSizing"]:checked').val().localeCompare("true")==0;if(e){$("#depthIn").attr("max",9);$("#threshIn").attr("disabled",false);if($("#depthIn").val()==8){$("#showDepth").html("9");$("#depthIn").val(9)}}else{$("#depthIn").attr("max",8);if($("#depthIn").val()==9){$("#depthIn").val(8);$("#showDepth").html("8")}$("#threshIn").attr("disabled",true)}})});var depth,smartSizing,thresh,image,time;var iFrequency=7500;var myInterval=0;$(function(){$("#myForm").submit(function(e){e.preventDefault();time=(new Date).getTime();$("#myForm").prepend($("<input>").attr({type:"text",name:"time",value:time}).css("display","none"));var t=$(this).attr("action");var n=document.getElementById("userPic");depth=document.getElementById("depthIn").value;smartSizing=$('input[name="smartSizing"]:checked').val().localeCompare("true")==0;thresh=null;if(smartSizing){thresh=document.getElementById("threshIn").value}$.ajax({url:t,type:"POST",data:new FormData(this),dataType:"json",processData:false,contentType:false});startCheck()})});$(function(){$("#mapId").on("click","area",function(){var e=this.id.split(",");showInfoBox(e[0],e[1],e[2],e[3],e[4],e[5],this);return false})});showInfoBox=function(e,t,n,r,i,s,o){hide($("#yourInputsDiv"),$("#toggleInputs"));show($("#blockInfo"),$("#toggleBlock"));$("#clickBlockInfo").remove();$("#blockInfo").empty();$("#blockInfo").append($("<img>").attr("src",e));$("#blockInfo").append($("<h5>").html("Title<br>").append($("<a>").attr({href:i,target:"_blank"}).html(n)));$("#blockInfo").append($("<h5>").html("Author<br>").append($("<a>").attr({href:"https://www.flickr.com/photos/"+r,target:"_blank"}).html(t)));makeLicenseLink(s);$("#blockInfo").append($("<p>").html("This image has been scaled in the mosaic."))};$(function(){$("#toggleInputs").on("click",function(){if($("#yourInputsDiv").is(":hidden")){show($("#yourInputsDiv"),$("#toggleInputs"));hide($("#blockInfo"),$("#toggleBlock"))}else{hide($("#yourInputsDiv"),$("#toggleInputs"));show($("#blockInfo"),$("#toggleBlock"))}});$("#toggleBlock").on("click",function(){if($("#blockInfo").is(":hidden")){show($("#blockInfo"),$("#toggleBlock"));hide($("#yourInputsDiv"),$("#toggleInputs"))}else{hide($("#blockInfo"),$("#toggleBlock"));show($("#yourInputsDiv"),$("#toggleInputs"))}})})